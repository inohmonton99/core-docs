<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.62">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-106005416-5","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Full stack vision AI on Kubernetes" href="/opensearch.xml">
<script src="/js/gtm.js"></script><title data-react-helmet="true">Adding a custom deep learning model and training Workflow to CVAT | Full stack vision AI on Kubernetes</title><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Adding a custom deep learning model and training Workflow to CVAT | Full stack vision AI on Kubernetes"><meta data-react-helmet="true" name="description" content="Onepanel - vision AI model training pipelines"><meta data-react-helmet="true" property="og:description" content="Onepanel - vision AI model training pipelines"><meta data-react-helmet="true" property="og:url" content="https://docs.onepanel.ai/docs/getting-started/use-cases/computervision/annotation/cvat/adding_custom_model"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://docs.onepanel.ai/docs/getting-started/use-cases/computervision/annotation/cvat/adding_custom_model"><link rel="stylesheet" href="/styles.43c40876.css">
<link rel="preload" href="/styles.3e64b083.js" as="script">
<link rel="preload" href="/runtime~main.ad6f4957.js" as="script">
<link rel="preload" href="/main.06ed058e.js" as="script">
<link rel="preload" href="/1.df872b40.js" as="script">
<link rel="preload" href="/2.8ac1142a.js" as="script">
<link rel="preload" href="/60.d2ba10a7.js" as="script">
<link rel="preload" href="/63.7f2de0e0.js" as="script">
<link rel="preload" href="/935f2afb.50cd1303.js" as="script">
<link rel="preload" href="/17896441.d4347639.js" as="script">
<link rel="preload" href="/6e3c029b.9d4de710.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.png" alt="Onepanel logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link" href="/docs/getting-started/quickstart">Getting Started</a><a class="navbar__item navbar__link" href="/docs/reference/overview">User Guide</a><a class="navbar__item navbar__link" href="/docs/deployment/overview">Operator Manual</a><a class="navbar__item navbar__link" href="/docs/api-sdk/overview">APIs and SDKs</a><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Releases</a><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Roadmap</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-community-label">Join the community:</a><a href="https://github.com/onepanelio/core/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-slack-link"></a><a href="https://github.com/onepanelio/core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-icon-link header-github-link"></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.png" alt="Onepanel logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/quickstart">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/deployment/overview">Operator Manual</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/api-sdk/overview">APIs and SDKs</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/releases" target="_blank" rel="noopener noreferrer" class="menu__link">Releases</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/milestones?direction=asc&amp;sort=due_date&amp;state=open" target="_blank" rel="noopener noreferrer" class="menu__link">Roadmap</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link header-community-label">Join the community:</a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core/discussions" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-slack-link"></a></li><li class="menu__list-item"><a href="https://github.com/onepanelio/core" target="_blank" rel="noopener noreferrer" class="menu__link header-icon-link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/reference/overview">User guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Workspaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/launching">Launching a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/pause-and-resume">Pause and resume</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/upgrade">Switching node pool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/delete">Terminating a Workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workspaces/templates">Workspace Templates</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/execute">Executing a Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/templates">Workflow Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/metrics">Persisting training metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/workflows/create">Creating a Workflow Template</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">CVAT Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_quick_guide">Getting started with image and video annotation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_annotation_model">Training with built-in models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_automatic_annotation">Using trained models for automatic annotation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/getting-started/use-cases/computervision/annotation/cvat/adding_custom_model">Adding custom deep learning models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_customizing_workspace_template">Customizing CVAT Workspace Template</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">JupyterLab Workspace</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/overview">JupyterLab overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/git">Using Git and browsing GitHub</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/tensorboard">Using TensorBoard</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/debugging">Using the built-in debugger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/jupyterlab/language-server">Auto completion and language features</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: Next</span></div><header><h1 class="docTitle_1Lrw">Adding a custom deep learning model and training Workflow to CVAT</h1></header><div class="markdown"><p>The default CVAT workspace comes with two workflows (i.e models)- MaskRCNN Training and TF Object Detection Training. These two workflows are generally good for semantic segmentation  and object detection tasks respectively. But you can do more with your CVAT tasks. You can, for example, train a Generative Adversarial Network model to generate synthetic data for your task. You can add your own model, if default models don&#x27;t satisfy your requirements.</p><p>This guide will walk you through the process of how can you add your own workflows for CVAT on Onepanel.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="1-requirements"></a>1. Requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1-requirements" title="Direct link to heading">#</a></h2><p>Before we dive into technical details of adding custom model support in CVAT, it&#x27;s important to know what types of models and data can be used with CVAT.</p><p>You can think of <code>Execute training Workflow</code> feature as a bridge between data in CVAT, be it annotated or just frames, and Onepanel Workflows. You can have Onepanel Workflows for model training, inference, and many other things. Let&#x27;s say you have a training workflow for some model X. Then, you can use this feature to use annotated frames from CVAT to train the model X. It dumps annotated data on cloud storage and Onepanel Workflows grabs data from the same location. More details on how to actually create such workflows will be discussed in following sections.</p><p>Now that you know how this feature works, it is safe to say that the <strong>only requirement</strong> here is that your training code has to support format that CVAT data was dumped into. For example, if your training code accepts data that follows COCO format (i.e JSON) then you need to export data in COCO format from CVAT. So, if your code does not accept data in any of the format that CVAT supports, then you can&#x27;t use that workflow from CVAT unless you just need frames and not the annotations. In any case, you can still create training workflow and execute on Onepanel. But you won&#x27;t be able to use this directly from CVAT. You will have to export data from CVAT, upload to cloud storage, execute workflow and pass-in correct cloud storage path.</p><p>If your code supports one of the following formats, then you are good to go.</p><ol><li>MS COCO</li><li>YOLO</li><li>TF Detection API (TFRecords)</li><li>MOT</li><li>LabelMe</li><li>DatuMaro</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="2-upload-code-to-github"></a>2. Upload code to Github<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2-upload-code-to-github" title="Direct link to heading">#</a></h2><p>Now that you know your code will work with CVAT, let&#x27;s go ahead and create a workflow for the same.The first step here is to upload your repository to Github. The workflow you are about to create will clone this repository and execute training command. </p><p>For this example, you are going to add a training workflow for DEtection TRansformer (DETR). <a href="https://github.com/facebookresearch/detr" target="_blank" rel="noopener noreferrer">DETR</a> was recently published by Facebook Research. Unlike many state-of-the-art object detection models, this works end-to-end using Transformers. Currently, Faster RCNN is a popular model for object detection. But it works in two phases. These multiple phases not only create overhead in training, they also take more time to train. This new model addresses these issues by approaching object detection task as a set prediction task. This is not a completely new approach but previous approaches didn&#x27;t report accuracy as good as Faster RCNN-based models.</p><p>The first thing you need to do is clone their Github <a href="https://github.com/facebookresearch/detr" target="_blank" rel="noopener noreferrer">repository</a>. We are cloning this because you may need to make some changes in code. If your code is stored locally, then you&#x27;ll have to upload it to Github. Also note that this code supports MS COCO format, so you can use this directly from CVAT.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="3-running-code-in-jupyterlab"></a>3. Running code in JupyterLab<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3-running-code-in-jupyterlab" title="Direct link to heading">#</a></h2><p>Before you create a workflow for this, you need to make sure it works without any issues and also understand how it works. You may also need to make some minor changes. You can do this locally or create a JupyterLab workspace on Onepanel. </p><p>Here, our goal is to have one script in this repository that takes required inputs (i.e epochs and other hyperparameters) from user and starts training, inference, etc. For this example, our goal is to create a workflow for training. So, we will focus on training part only. You can have a flag in this script and run training or inference based on user input.</p><p>The only major different between running this code localy and in a workflow is that our annotated data will be dumped onto cloud storage, so we will map that directory with any local directory. Hence, you need to update directory structure and fix it to any directory (i.e <code>/mnt/data/dataset/</code>). This is where you will mount our dataset from cloud storage. </p><p>Now, let&#x27;s see if DETR has main script which takes user inputs and runs training. If you look at <code>main.py</code> in the root directory, you will find that this script accepts a myriad of arguments from user and runs training/inference. So, you don&#x27;t have to create a new script. </p><p><strong>If your code supports one of the dataset format that CVAT can export into, then you&#x27;ll have to modify only two things: input and output paths.</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="a-input-paths"></a>a. Input paths<a aria-hidden="true" tabindex="-1" class="hash-link" href="#a-input-paths" title="Direct link to heading">#</a></h3><p>Since you will be mounting dataset at a fixed location (i.e <code>/mnt/data/datasets/</code>), you can hard-code this path in your code. Moreover, you also need to look at directory structure inside this directory. Since our code accepts data in COCO format, let&#x27;s export data from CVAT in MS COCO format and take a look at it&#x27;s directory structure.</p><p><img alt="COCO Directory Structure" src="/assets/images/coco_dir-c0bba3c790ddcd413d727758e593b3bc.png"></p><p>If you are familiar with officail COCO directory structure or even take a look at DETR code, you will find that this does not follow official COCO directory structure. Since this code supports officail COCO directory structure, you need to modify some lines to make it work. Also, the <code>file_path</code> attribute in JSON file points to frames on the machine where it was exported. So, this won&#x27;t work on other machine (i.e workflows that you will be running).</p><p>So, you will need to make two changes.</p><p><strong>1. Update directory structure in the code (<code>datasets/coco.py</code>).</strong>
This is very simple. You just need to update following lines from <a href="https://github.com/onepanelio/detr/blob/master/datasets/coco.py#L151" target="_blank" rel="noopener noreferrer"><code>datasets/coco.py</code></a></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python3 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PATHS = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;train&quot;: (root / &quot;train2017&quot;, root / &quot;annotations&quot; / f&#x27;{mode}_train2017.json&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;val&quot;: (root / &quot;val2017&quot;, root / &quot;annotations&quot; / f&#x27;{mode}_val2017.json&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><p>to</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python3 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> PATHS = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;train&quot;: (root / &quot;images&quot;, root / &quot;annotations&quot; / &#x27;instances_default.json&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;val&quot;: (root / &quot;images&quot;, root / &quot;annotations&quot; / &#x27;instances_default.json&#x27;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div></div></div><p>Note that for simplicity we are using train set as a validation set. But that&#x27;s not the ideal thing to do. You can split train set into train and val set. Or use other dataset present on cloud storage while executing the workflow.</p><p><strong>2. Write a function/script to update <code>file_path</code> in a JSON file.</strong></p><p>Since we will be mounting dataset at <code>/mnt/data/datasets/</code>, you can update paths in JSON accordingly. Hence, we will write a script (<code>prepare_data.py</code>) that does this. And, we will execute this script before we call <code>main.py</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-python3 codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">def update_img_paths(args):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # read json data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    with open(args.file_path, &quot;r&quot;) as file:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        json_data = json.load(file)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        # update image path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for img in json_data[&#x27;images&#x27;]:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            img[&#x27;file_name&#x27;] = os.path.join(args.prefix, os.path.basename(img[&#x27;file_name&#x27;]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        # write data back to file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        with open(args.file_path, &quot;w&quot;) as file_out:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            json.dump(json_data, file_out)</span></div></div></div></div></div><p>Once this is done. You are good to go. You can now go ahead and create Onepanel Workflow. This can be used from CVAT or can be executed directly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="b-output-path"></a>b. Output path<a aria-hidden="true" tabindex="-1" class="hash-link" href="#b-output-path" title="Direct link to heading">#</a></h3><p>If you want Onepanel Workflows to store outputs on cloud storage, you can just write output to <code>/mnt/output/</code> and it will automatically upload outputs onto cloud storage. For this to work, you just need to add output artifact in our template as discussed in the following section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="4-create-a-workflow"></a>4. Create a workflow<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4-create-a-workflow" title="Direct link to heading">#</a></h2><p>Now, let&#x27;s go ahead and actually create a workflow. You can create a new workflow but we recommend you just clone MaskRCNN Training Workflow which is included by default and make changes there.</p><p><img alt="Clone Workflow" src="/assets/images/maskrcnn_clone-284519c1e51f3d9e6465246bfc543943.png"></p><p>You will see a YAML editor as shown below.</p><p><img alt="Create workflow" src="/assets/images/maskrcnn_clone_editor-de7a2701e1b3279254af7fc3e640a7b8.png"></p><p>Give this template an appropriate name. For this example, we will be using <code>DETR Training</code>.</p><p>You can use <a href="https://github.com/onepanelio/templates/blob/master/workflows/maskrcnn-training/template.yaml" target="_blank" rel="noopener noreferrer">MaskRCNN template</a> as our starting point and you can modify it for your needs.</p><p>Below is a MaskRCNN template which we&#x27;ll use as our base template. Hints and other unnecessary stuff was removed for brevity. You can find complete template <a href="https://github.com/onepanelio/templates/blob/master/workflows/maskrcnn-training/template.yaml" target="_blank" rel="noopener noreferrer">here</a>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/onepanelio/Mask_RCNN.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Model source code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">dump/sample_dataset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to annotated data in default object storage (i.e S3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Dataset path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data/output/sample_output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to store output artifacts in default object storage (i.e s3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Workflow output path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hyperparameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Hyperparameters</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> textarea.textarea</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">epochs=1    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  Epochs for network heads</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">epochs=2    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  Epochs for finetune layers</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">epochs=3    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#  Epochs for all layers</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">finetune</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">checkpoint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">classes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">81</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat_coco</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">image</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tensorflow/tensorflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.13.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">py3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Standard_D4s_v3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">templates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tensorflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      apt-get update \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; apt-get install -y git wget libglib2.0-0 libsm6 libxext6 libxrender-dev \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; pip install -r requirements.txt \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; pip install boto3 pyyaml google-cloud-storage \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; git clone https://github.com/waleedka/coco \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd coco/PythonAPI \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python setup.py build_ext install \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; rm -rf build \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd ../../ \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; wget https://github.com/matterport/Mask_RCNN/releases/download/v2.0/mask_rcnn_coco.h5 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python setup.py install &amp;&amp; ls \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python samples/coco/cvat.py train --dataset=/mnt/data/datasets \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --model=workflow_maskrcnn \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --extras=&quot;{{workflow.parameters.extras}}&quot;  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --ref_model_path=&quot;{{workflow.parameters.cvat-finetune-checkpoint}}&quot;  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --num_classes=&quot;{{workflow.parameters.cvat-num-classes}}&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd /mnt/src/ \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python prepare_dataset.py /mnt/data/datasets/annotations/instances_default.json</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.tf-image}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">workingDir</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">beta.kubernetes.io/instance-type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.cvat-node-pool}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data/datasets/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-annotation-path}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">git</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.source}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">revision</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;no-boto&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tensorflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">optional</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-output-path}}/{{workflow.name}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 200Gi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 200Gi</span></div></div></div></div></div><p>Even though this looks cryptic, it isn&#x27;t. Let us go through following three steps to create template for DETR.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="a-update-workflow-parameters"></a>a. Update workflow parameters<a aria-hidden="true" tabindex="-1" class="hash-link" href="#a-update-workflow-parameters" title="Direct link to heading">#</a></h3><p>The first thing you should do is add/remove parameters from above template. Now, how do you figure out which parameters should you use in there? Use arguments/parameters that you take from user plus some system related parameter (optional). Some examples of this is <code>epochs</code>, <code>batch_size</code>, etc. Again, this depends on your code as well. In this case, our <code>main.py</code> accepts all those hyperparameters as an argument. If your code didn&#x27;t have such an argument parser, then you can pass all hyperparameters, as shown above for <code>hyperparameters</code> parameter, and parse it in your code.</p><p>First, you need to update <code>source</code> parameter to use code that you just clones. If your code is in private mode, <a href="/docs/reference/workflows/templates#git-integration-with-workflows">refer to our guide</a> on git integration to know how you can use private repositories with Workflows. We will also have to update docker image to use PyTorch with cuda. Since we will be deploying this on Azure for this guide, we will use <code>Standard_NC6</code> for <code>sys-node-pool</code>. This machine has K80 GPU.</p><p>Next, you can remove <code>hyperparameters</code>, <code>cvat-num-classes</code>, and <code>cvat-finetune-checkpoint</code> as you won&#x27;t need them.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/onepanelio/detr.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Model source code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">dump/sample_dataset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to annotated data in default object storage (i.e S3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Dataset path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data/output/sample_output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to store output artifacts in default object storage (i.e s3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Workflow output path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat_coco</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pytorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">image</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pytorch/pytorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.6.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cuda10.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cudnn7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">runtime</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Standard_NC6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div></div></div></div></div><p>Here, if <code>visibility</code> is public, then it will be shown in CVAT. Notice some parameters are prefixed with <code>cvat-</code>, they will be automatically populated by CVAT. <code>dump-format</code> specifies which format should CVAT dump data into. If you have this parameter in a workflow and has correct value (i.e cvat_coco), then it won&#x27;t be shown in CVAT. </p><p>Basically, you don&#x27;t have to specify any parameter to run this workflow from CVAT. </p><p>Now, let&#x27;s go ahead and add some parameters that you might need for this model.</p><p>Let&#x27;s add <code>epochs</code> and <code>batch_size</code> as you will be using them to run the training.</p><p>So, finally our parameters will look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">parameters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/onepanelio/detr.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Model source code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hidden</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">dump/sample_dataset</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to annotated data in default object storage (i.e S3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Dataset path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data/output/sample_output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Path to store output artifacts in default object storage (i.e s3). In CVAT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this parameter will be pre</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">populated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Workflow output path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> private</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> dump</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cvat_coco</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pytorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">image</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pytorch/pytorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">1.6.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cuda10.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cudnn7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">runtime</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Standard_NC6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> epochs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;50&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> batch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">size</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">visibility</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> public</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="b-update-container-block"></a>b. Update container block<a aria-hidden="true" tabindex="-1" class="hash-link" href="#b-update-container-block" title="Direct link to heading">#</a></h3><p>Now, let&#x27;s take a look at the second block of a base template.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">templates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tensorflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      apt-get update \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; apt-get install -y git wget libglib2.0-0 libsm6 libxext6 libxrender-dev \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; pip install -r requirements.txt \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; pip install boto3 pyyaml google-cloud-storage \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; git clone https://github.com/waleedka/coco \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd coco/PythonAPI \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python setup.py build_ext install \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; rm -rf build \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd ../../ \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; wget https://github.com/matterport/Mask_RCNN/releases/download/v2.0/mask_rcnn_coco.h5 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python setup.py install &amp;&amp; ls \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python samples/coco/cvat.py train --dataset=/mnt/data/datasets \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --model=workflow_maskrcnn \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --extras=&quot;{{workflow.parameters.extras}}&quot;  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --ref_model_path=&quot;{{workflow.parameters.cvat-finetune-checkpoint}}&quot;  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        --num_classes=&quot;{{workflow.parameters.cvat-num-classes}}&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; cd /mnt/src/ \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python prepare_dataset.py /mnt/data/datasets/annotations/instances_default.json</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.tf-image}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">workingDir</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">beta.kubernetes.io/instance-type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.sys-node-pool}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data/datasets/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-annotation-path}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">git</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.source}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">revision</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;no-boto&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">workflow.name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tensorflow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">optional</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-output-path}}/{{workflow.name}}&#x27;</span></div></div></div></div></div><p>First thing you may do is rename the template name from <code>tensorflow</code> to <code>detr</code>, its not required though. Then, you can remove that <code>no-boto</code> branch from <code>git</code> section as we will be using default (<code>master</code>) branch for DETR.</p><p>Lastly, you just need to update the command that starts the training. You can see ~20 lines of commands. But you won&#x27;t need that many for this. Let&#x27;s remove those lines and write our own.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> update </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> -y build-essential </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> pip </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> cython pycocotools scipy </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> python /mnt/src/prepare_data.py </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> python /mnt/src/main.py --coco_path</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/mnt/data/datasets/ --output_dir</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/mnt/output/ --batch_size</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">workflow.parameters.batch-size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> --epochs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">workflow.parameters.epochs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>We know that we need to run <code>prepare_data.py</code> script to modify paths as we observed in the last section and run <code>main.py</code> to start the training.</p><p>Finally, our updated block looks like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">entrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">templates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> train</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> detr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> main</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      apt-get update \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; apt-get install -y build-essential \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; pip install cython pycocotools scipy \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python /mnt/src/prepare_data.py \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      &amp;&amp; python /mnt/src/main.py --coco_path=/mnt/data/datasets/ --output_dir=/mnt/output/ --batch_size={{workflow.parameters.batch-size}} --epochs={{workflow.parameters.epochs}}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> sh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.pytorch-image}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">workingDir</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">beta.kubernetes.io/instance-type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.sys-node-pool}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/data/datasets/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-annotation-path}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">git</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.parameters.source}}&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> detr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">outputs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">artifacts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> model</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">optional</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /mnt/output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{{workflow.namespace}}/{{workflow.parameters.cvat-output-path}}/{{workflow.name}}&#x27;</span></div></div></div></div></div><p>Note that docker image parameter was also updated to <code>pytorch-image</code>.</p><p>We also attached some input and output artifacts. For inputs, we had training data and source code. For output, we will be dumping data from <code>/mnt/output/</code> directory to <code>{{workflow.namespace}}/{{workflow.parameters.cvat-output-path}}/{{workflow.name}}</code>.</p><p>Also notice that we selected a node with machine that user specified through parameter <code>sys-node-pool</code>. What we are essentially doing here is that we are using PyTorch container on this machine, attaching input artifacts (i.e training data), and running commands that perform required tasks (i.e training a model).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="c-update-volume-claims"></a>c. Update volume claims<a aria-hidden="true" tabindex="-1" class="hash-link" href="#c-update-volume-claims" title="Direct link to heading">#</a></h3><p>Now, let&#x27;s take a look at the final block.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 200Gi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> output</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 200Gi</span></div></div></div></div></div><p>As you can see, this block defines volume claims. Based on your model and data, you can change this from 200 GB to whatever you need. But you can keep this as it is.</p><p>One last thing you need to do in order to use this template from CVAT is to add a label as shown below. If you want to use a Workflow in CVAT, add a label with <code>key</code>=<code>used-by</code> and <code>value</code>=<code>cvat</code>.</p><p><img alt="Workflow Label" src="/assets/images/update_labels-90b5bbc9c00573a2fed7ac8e6a51fae7.png"></p><p>With this, you have a final template for training DETR model.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="5-using-it-in-cvat"></a>5. Using it in CVAT<a aria-hidden="true" tabindex="-1" class="hash-link" href="#5-using-it-in-cvat" title="Direct link to heading">#</a></h2><p>Now, you can use this model to train models from CVAT.</p><p>Click on <code>Actions</code> menu under the CVAT task you want to train model on, select <code>Execute training Workflow</code>.</p><p>Select the newly created template. In my case, it was <code>DETR Training</code>.</p><p><img alt="DETR Execute" src="/assets/images/detr_execute-74484fd39c816ca56467992dbd213eef.png"></p><p>Modify parameters, if you want. But changes aren&#x27;t required. Just hit <code>Submit</code> and it will start the training by executing this workflow. </p><p><img alt="DETR Training" src="/assets/images/detr_training-80b62df0388c6a7f2a25b687359dc730.png"></p><p>You can find your trained model (i.e output) in <code>cvat-output-path</code> directory on your cloud storage.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/onepanelio/core-docs/tree/master/docs/getting-started/use-cases/computervision/annotation/cvat/adding_custom_model.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_automatic_annotation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Semi-automatic annotation with CVAT</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/getting-started/use-cases/computervision/annotation/cvat/cvat_customizing_workspace_template"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Customizing CVAT Workspace Template Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-requirements" class="table-of-contents__link">1. Requirements</a></li><li><a href="#2-upload-code-to-github" class="table-of-contents__link">2. Upload code to Github</a></li><li><a href="#3-running-code-in-jupyterlab" class="table-of-contents__link">3. Running code in JupyterLab</a><ul><li><a href="#a-input-paths" class="table-of-contents__link">a. Input paths</a></li><li><a href="#b-output-path" class="table-of-contents__link">b. Output path</a></li></ul></li><li><a href="#4-create-a-workflow" class="table-of-contents__link">4. Create a workflow</a><ul><li><a href="#a-update-workflow-parameters" class="table-of-contents__link">a. Update workflow parameters</a></li><li><a href="#b-update-container-block" class="table-of-contents__link">b. Update container block</a></li><li><a href="#c-update-volume-claims" class="table-of-contents__link">c. Update volume claims</a></li></ul></li><li><a href="#5-using-it-in-cvat" class="table-of-contents__link">5. Using it in CVAT</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2020 Onepanel, Inc.</div></div></div></footer></div>
<script src="/styles.3e64b083.js"></script>
<script src="/runtime~main.ad6f4957.js"></script>
<script src="/main.06ed058e.js"></script>
<script src="/1.df872b40.js"></script>
<script src="/2.8ac1142a.js"></script>
<script src="/60.d2ba10a7.js"></script>
<script src="/63.7f2de0e0.js"></script>
<script src="/935f2afb.50cd1303.js"></script>
<script src="/17896441.d4347639.js"></script>
<script src="/6e3c029b.9d4de710.js"></script>
</body>
</html>